# Tacview-Like 可视化系统软件架构设计文档

> 本文档为 Tacview-Like 三维飞行可视化系统的软件架构设计方案，面向多开发者协作，强调模块解耦、接口清晰、通信标准一致，支持后续扩展和演进。

---

## 1. 架构原则

- **模块化设计**：每个模块具有独立职责，方便开发、测试与替换。
- **高内聚、低耦合**：模块之间仅通过接口/协议通信，避免直接依赖。
- **接口驱动开发**：先定义模块间协议，内部实现自由。
- **最小可用功能**：每个模块需先实现其最基本职责，逐步扩展。
- **支持可演进性**：系统架构支持未来功能扩展，如更多目标类型、网络数据、VR支持等。

---

## 2. 系统模块划分

    [ 数据模块 ]
          |
          v
  [ 场景管理模块 ]
          |
          v
  [ 渲染模块 ] <--------+
          |            |
          v            |
    [ UI 控制模块 ]     |
          |            |
          v            |
  [ 平台适配/输入模块 ] +

---

## 3. 模块说明与边界设计

### 3.1 数据模块（Data Layer）

- **职责**：解析包括但不限于 ACMI 格式的数据文件，输出标准时间帧数据格式。
- **不做**：不控制播放，不参与渲染。
- **对外能力**：提供按时间获取的对象状态集。

---

### 3.2 场景管理模块（Scene Manager）

- **职责**：组织对象生命周期管理、时间同步、状态调度。
- **不做**：不渲染、不处理用户事件。
- **对外能力**：提供“当前时间帧的所有对象状态”。

---

### 3.3 渲染模块（Rendering Layer）

- **职责**：负责所有图形可视化内容的绘制（目标、地球、轨迹等）。
- **不做**：不解析数据、不管理播放状态。
- **对外能力**：提供 `render(帧数据)` 接口。

---

### 3.4 UI 控制模块（UI Controller）

- **职责**：提供用户界面交互，包括时间控制、视角切换、数据加载等。
- **不做**：不参与数据解析/渲染/状态调度。
- **对外能力**：通过控制指令（Command）发起行为请求。

---

### 3.5 平台适配层（Platform Layer）

- **职责**：处理平台依赖，如窗口创建、事件派发、输入设备适配。
- **不做**：不定义核心业务逻辑。
- **对外能力**：向 UI 或视角控制模块转发平台级事件。

---

## 4. 模块间通信协议

### 4.1 数据协议（状态数据标准格式）暂定，根据实际情况讨论着来

用于：数据模块 → 场景管理模块 → 渲染模块

```jsonc
{
  "time": 3.25,
  "objects": {
    "A0100": {
      "position": [123.4, 45.6, 7890.0], // [lon, lat, alt]
      "pitch": 10.0,
      "roll": 5.0,
      "yaw": 180.0
    },
    "B0200": {
      "position": [...],
      ...
    }
  }
}
```
可选字段扩展（如目标类型、颜色等）不影响协议兼容性；

场景管理模块可以将其封装为对象集合传给渲染模块。

### 控制协议（Command-Based 控制流）暂定，根据实际情况讨论着来

用于：UI 控制模块 → 播放控制、视角切换模块

```c++
// 指令类型
enum class CommandType {
    LoadFile,      // 加载 ACMI 文件
    Play,          // 开始播放
    Pause,         // 暂停播放
    Seek,          // 跳转到指定时间
    ChangeView     // 切换视角
};

// 控制指令结构
struct Command {
    CommandType type;
    QVariant payload; // 可包含时间戳、文件路径、视角标识等
};

```
模块之间统一通过 Command 结构体通信；

播放控制模块应具备处理上述指令集的接口；

可拓展指令类型以适配未来功能（如录制、截图等）。

## 模块边界说明（协作约定）

| 模块间交互     | 通信方式            | 示例描述                          |
|----------------|---------------------|-----------------------------------|
| 数据 → 场景     | 共享帧数据结构       | `getObjectStatesAt(time)`         |
| 场景 → 渲染     | 提供状态结构列表     | `render(objects)`                 |
| UI → 播放控制   | 下发指令（Command） | `Command{type=Play}`              |
| UI → 视角控制   | 设置视角 ID          | `setView(ViewType::Free)`         |
| 平台 → UI       | 事件派发回调         | `onMouseMove(int x, int y)`       |


## 6. 项目协作建议

接口优先开发：先定义每个模块对外接口协议，后开发内部逻辑；

接口文档共享：统一放置模块通信协议文档，所有开发者遵守；

独立测试能力：每个模块应支持本地测试（模拟数据/指令）；

持续集成计划：定期进行主流程集成测试，确保模块组合稳定；

预留扩展机制：如目标类型、轨迹风格、不同渲染视图等均可通过插件或策略注册扩展。

## 8. 后续扩展建议

支持更多目标类型（UAV/UUV 等）插件式接入；

添加轨迹与历史路径绘制；

支持 ACMI 数据流实时输入；

平台层支持 GLFW/Qt 可插拔切换；

接入 Qt Quick 作为 UI 层重构选项。